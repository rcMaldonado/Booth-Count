"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var router_1 = require("nativescript-angular/router");
var angular_1 = require("nativescript-ui-sidedrawer/angular");
var nativescript_fancyalert_1 = require("nativescript-fancyalert");
var localStorage = require("nativescript-localstorage");
var Toast = require("nativescript-toasts");
var dialogs = require("ui/dialogs");
var Sqlite = require("nativescript-sqlite");
var MainComponent = /** @class */ (function () {
    function MainComponent(_changeDetectionRef, router) {
        this._changeDetectionRef = _changeDetectionRef;
        this.router = router;
        this.sales = [];
        this.createInventory();
        this.createSales();
    }
    MainComponent.prototype.ngAfterViewInit = function () {
        this.drawer = this.drawerComponent.sideDrawer;
        this._changeDetectionRef.detectChanges();
    };
    MainComponent.prototype.ngOnInit = function () {
        this.vendor = localStorage.getItem("vendor");
        this.name = this.vendor.name;
        this.salesId = localStorage.getItem("salesId");
        this.fetch(); // Consigue todos los items del inventario (inventory table).
        this.getSales(); // Consigue todos los item de sales.
        console.log("SalesId is: ", this.salesId);
    };
    //Ejecutada cuando el usuario selecciona una celda.
    MainComponent.prototype.onItemTap = function (args) {
        var _this = this;
        var index = args.index;
        var selectedItem = {
            "productId": this.inventory[index].productId,
            "productCode": this.inventory[index].productCode,
            "productName": this.inventory[index].productName,
            "productCategory": this.inventory[index].productCategory,
            "productPrice": this.inventory[index].productPrice,
            "balance": this.inventory[index].balance,
            "quantity": 1
        };
        if (this.inventory[index].isVisible) {
            dialogs.confirm({
                title: "Eliminar del Bolso",
                message: "¿Desea eliminar el producto del bolso de compra?",
                okButtonText: "Si",
                cancelButtonText: "No"
            }).then(function (result) {
                if (result.valueOf()) {
                    _this.inventory[index].isVisible = 0;
                    _this.updateInventory(selectedItem.productId, _this.inventory[index].isVisible, selectedItem.quantity, selectedItem.productPrice);
                }
            });
        }
        else {
            dialogs.prompt({
                title: "Cantidad a Vender",
                message: "Entre la cantidad de productos que desea vender.",
                okButtonText: "Confirmar",
                cancelButtonText: "Cancelar",
                defaultText: selectedItem.quantity.toString(),
                inputType: dialogs.inputType.text,
            }).then(function (result) {
                // console.log("Dialog result: " + result.result + ", text: " + result.text);
                if (isNaN(+result.text) || result.text === "" || result.text === undefined) {
                    dialogs.confirm({
                        title: "Entre un valor númerico",
                        message: "Favor de entrar un valor númerico para que el producto sea añadido al bolso de ventas.",
                        okButtonText: "OK",
                    });
                }
                else {
                    if (result.result) {
                        selectedItem.quantity = +result.text;
                        _this.sales.push(selectedItem);
                        _this.inventory[index].isVisible = 1;
                        //Se actualiza el inventario indicando que el producto es deseado
                        _this.updateInventory(selectedItem.productId, _this.inventory[index].isVisible, selectedItem.quantity, selectedItem.productPrice);
                        console.log(_this.sales);
                    }
                }
            });
        }
    };
    MainComponent.prototype.createInventory = function () {
        var _this = this;
        (new Sqlite("booth.db")).then(function (db) {
            db.execSQL("CREATE TABLE IF NOT EXISTS inventory (id INTEGER PRIMARY KEY AUTOINCREMENT, productCode TEXT, productName TEXT, productCategory TEXT, productPrice TEXT, initialBalance INTEGER, balance INTEGER, isVisible INTEGER)").then(function (id) {
                _this.database = db;
                console.log("Success");
            }, function (error) {
                console.log("CREATE TABLE ERROR", error);
            });
        }, function (error) {
            console.log("OPEN DB ERROR", error);
        });
    };
    MainComponent.prototype.fetch = function () {
        var _this = this;
        this.database.all("SELECT * FROM inventory").then(function (rows) {
            _this.inventory = [];
            for (var row in rows) {
                _this.inventory.push({
                    "productId": rows[row][0],
                    "productCode": rows[row][1],
                    "productName": rows[row][2],
                    "productCategory": rows[row][3],
                    "productPrice": rows[row][4],
                    "initialBalance": rows[row][5],
                    "balance": rows[row][6],
                    "isVisible": rows[row][7],
                });
            }
        }, function (error) {
            console.log("SELECT ERROR", error);
        });
    };
    MainComponent.prototype.updateInventory = function (id, isVisible, quantity, price) {
        var _this = this;
        this.database.execSQL("UPDATE inventory SET isVisible = " + isVisible + " WHERE id = " + id).then(function () {
            console.log("Inventario Actualizado");
            if (isVisible === 1) {
                var priceSum = _this.getPriceSum(quantity, price);
                _this.insertToSales(id, quantity, priceSum);
                _this.getSales();
            }
            else {
                _this.deleteSale(id);
                _this.getSales();
            }
        }, function (error) {
            console.log("INSERT ERROR", error);
        });
    };
    /* Se crea la tabla sales en donde se estara guardando la información
    de las ventas que se estan haciendo al momento. Estas se convertiran en orden
    en el bolso de ventas. Esta función es llamada en el constructor. */
    MainComponent.prototype.createSales = function () {
        var _this = this;
        (new Sqlite("booth.db")).then(function (db) {
            var vendorId = "FOREIGN KEY (vendorId) REFERENCES vendor(vendorId) ON UPDATE CASCADE ON DELETE CASCADE, ";
            var productId = " FOREIGN KEY (productId) REFERENCES inventory(id) ON UPDATE CASCADE ON DELETE CASCADE, ";
            db.execSQL("CREATE TABLE IF NOT EXISTS sales (salesId INTEGER, vendorId INTEGER NOT NULL, productId INTEGER NOT NULL, quantityToSale INTEGER, priceSum  TEXT, " + vendorId + productId + " PRIMARY KEY (salesId, vendorId, productId))").then(function (id) {
                _this.database = db;
                console.log("Success");
            }, function (error) {
                console.log("CREATE TABLE ERROR", error);
            });
        }, function (error) {
            console.log("OPEN DB ERROR", error);
        });
    };
    MainComponent.prototype.getSales = function () {
        var _this = this;
        this.database.all("SELECT * FROM sales WHERE sales.salesId = " + this.salesId).then(function (rows) {
            _this.sales = [];
            for (var row in rows) {
                _this.sales.push({
                    "salesId": rows[row][0],
                    "vendorId": rows[row][1],
                    "productId": rows[row][2],
                    "quantityToSale": rows[row][3],
                    "priceSum": rows[row][4]
                });
            }
            console.log(_this.sales);
        }, function (error) {
            console.log("SELECT ERROR", error);
        });
    };
    MainComponent.prototype.insertToSales = function (productId, quantity, price) {
        var _this = this;
        this.database.execSQL("INSERT or IGNORE INTO sales (salesId, vendorId, productId, quantityToSale, priceSum) VALUES (?, ?, ?, ?, ?)", [this.salesId, this.vendor.vendorId, productId, quantity, price]).then(function () {
            var message = 'Producto añadido al bolso de ventas';
            var toastOptions = { text: message, duration: Toast.DURATION.SHORT };
            Toast.show(toastOptions);
            _this.getSales();
        }, function (error) {
            console.log("INSERT ERROR", error);
        });
    };
    MainComponent.prototype.deleteSale = function (productId) {
        this.database.execSQL("DELETE FROM sales WHERE productId=" + productId).then(function () {
            var message = 'Producto eliminado del bolso de ventas';
            var toastOptions = { text: message, duration: Toast.DURATION.SHORT };
            Toast.show(toastOptions);
        }, function (error) {
            console.log("INSERT ERROR", error);
        });
    };
    MainComponent.prototype.getPriceSum = function (quantity, price) {
        var total = +quantity * +price;
        return total;
    };
    MainComponent.prototype.openDrawer = function () {
        this.drawer.showDrawer();
    };
    MainComponent.prototype.onCloseDrawerTap = function () {
        this.drawer.closeDrawer();
    };
    MainComponent.prototype.orderBag = function () {
        if (this.sales.length === 0) {
            var title = "No Hay Productos";
            var message = "No hay productos en el bolso de venta, favor de seleccionar un producto para producir una orden.";
            var buttonTitle = "OK";
            nativescript_fancyalert_1.TNSFancyAlert.showWarning(title, message, buttonTitle);
        }
        else {
            this.router.navigate(["bag"]);
        }
    };
    MainComponent.prototype.toInicio = function () {
        this.router.navigate(['main'], { clearHistory: true });
    };
    MainComponent.prototype.toInventario = function () {
        this.router.navigate(['inventario'], { clearHistory: true });
    };
    MainComponent.prototype.toOrdenes = function () {
        this.router.navigate(['ordenes'], { clearHistory: true });
    };
    MainComponent.prototype.toAjustes = function () {
        this.router.navigate(['settings'], { clearHistory: true });
    };
    MainComponent.prototype.toAbout = function () {
        this.router.navigate(["about"], { clearHistory: true });
    };
    __decorate([
        core_1.ViewChild(angular_1.RadSideDrawerComponent),
        __metadata("design:type", angular_1.RadSideDrawerComponent)
    ], MainComponent.prototype, "drawerComponent", void 0);
    MainComponent = __decorate([
        core_1.Component({
            moduleId: module.id,
            selector: "main",
            templateUrl: "./main.component.html",
            styleUrls: ["./main.component.css"]
        }),
        __metadata("design:paramtypes", [core_1.ChangeDetectorRef, router_1.RouterExtensions])
    ], MainComponent);
    return MainComponent;
}());
exports.MainComponent = MainComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJtYWluLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNDQUErRjtBQUUvRixzREFBK0Q7QUFDL0QsOERBQTRGO0FBQzVGLG1FQUE2RTtBQUU3RSx3REFBMEQ7QUFDMUQsMkNBQTZDO0FBQzdDLG9DQUFzQztBQUt0QyxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQVM1QztJQVVJLHVCQUFvQixtQkFBc0MsRUFBVSxNQUF3QjtRQUF4RSx3QkFBbUIsR0FBbkIsbUJBQW1CLENBQW1CO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBa0I7UUFIckYsVUFBSyxHQUFlLEVBQUUsQ0FBQztRQUkxQixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUFLRCx1Q0FBZSxHQUFmO1FBQ0ksSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQztRQUM5QyxJQUFJLENBQUMsbUJBQW1CLENBQUMsYUFBYSxFQUFFLENBQUM7SUFFN0MsQ0FBQztJQUVELGdDQUFRLEdBQVI7UUFDSSxJQUFJLENBQUMsTUFBTSxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDN0MsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztRQUM3QixJQUFJLENBQUMsT0FBTyxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDL0MsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsNkRBQTZEO1FBQzNFLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLG9DQUFvQztRQUNyRCxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsT0FBTyxD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UUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztJQUMzRCxDQUFDO0lBbk9rQztRQUFsQyxnQkFBUyxDQUFDLGdDQUFzQixDQUFDO2tDQUF5QixnQ0FBc0I7MERBQUM7SUFmekUsYUFBYTtRQU56QixnQkFBUyxDQUFDO1lBQ1AsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1lBQ25CLFFBQVEsRUFBRSxNQUFNO1lBQ2hCLFdBQVcsRUFBRSx1QkFBdUI7WUFDcEMsU0FBUyxFQUFFLENBQUMsc0JBQXNCLENBQUM7U0FDdEMsQ0FBQzt5Q0FXMkMsd0JBQWlCLEVBQWtCLHlCQUFnQjtPQVZuRixhQUFhLENBbVB6QjtJQUFELG9CQUFDO0NBQUEsQUFuUEQsSUFtUEM7QUFuUFksc0NBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIFZpZXdDaGlsZCwgT25Jbml0LCBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3RvclJlZiB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5cbmltcG9ydCB7IFJvdXRlckV4dGVuc2lvbnMgfSBmcm9tIFwibmF0aXZlc2NyaXB0LWFuZ3VsYXIvcm91dGVyXCI7XG5pbXBvcnQgeyBSYWRTaWRlRHJhd2VyQ29tcG9uZW50LCBTaWRlRHJhd2VyVHlwZSB9IGZyb20gXCJuYXRpdmVzY3JpcHQtdWktc2lkZWRyYXdlci9hbmd1bGFyXCI7XG5pbXBvcnQgeyBUTlNGYW5jeUFsZXJ0LCBUTlNGYW5jeUFsZXJ0QnV0dG9uIH0gZnJvbSAnbmF0aXZlc2NyaXB0LWZhbmN5YWxlcnQnO1xuaW1wb3J0IHsgUmFkU2lkZURyYXdlciB9IGZyb20gJ25hdGl2ZXNjcmlwdC11aS1zaWRlZHJhd2VyJztcbmltcG9ydCAqIGFzIGxvY2FsU3RvcmFnZSBmcm9tIFwibmF0aXZlc2NyaXB0LWxvY2Fsc3RvcmFnZVwiO1xuaW1wb3J0ICogYXMgVG9hc3QgZnJvbSAnbmF0aXZlc2NyaXB0LXRvYXN0cyc7XG5pbXBvcnQgKiBhcyBkaWFsb2dzIGZyb20gXCJ1aS9kaWFsb2dzXCI7XG5cbmltcG9ydCB7IFZlbmRvciB9IGZyb20gXCIuLi9vYmplY3RzL3ZlbmRvclwiO1xuaW1wb3J0IHsgSW52ZW50b3J5IH0gZnJvbSBcIi4uL29iamVjdHMvaW52ZW50b3J5L2ludmVudG9yeVwiO1xuXG52YXIgU3FsaXRlID0gcmVxdWlyZShcIm5hdGl2ZXNjcmlwdC1zcWxpdGVcIik7XG5cblxuQENvbXBvbmVudCh7XG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcbiAgICBzZWxlY3RvcjogXCJtYWluXCIsXG4gICAgdGVtcGxhdGVVcmw6IFwiLi9tYWluLmNvbXBvbmVudC5odG1sXCIsXG4gICAgc3R5bGVVcmxzOiBbXCIuL21haW4uY29tcG9uZW50LmNzc1wiXVxufSlcbmV4cG9ydCBjbGFzcyBNYWluQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25Jbml0IHtcblxuICAgIHByaXZhdGUgZGF0YWJhc2U6IGFueTtcblxuICAgIHB1YmxpYyBpbnZlbnRvcnk6IEFycmF5PEludmVudG9yeT47XG4gICAgcHVibGljIHZlbmRvcjogVmVuZG9yO1xuICAgIHB1YmxpYyBuYW1lOiBTdHJpbmc7XG4gICAgcHVibGljIHNhbGVzOiBBcnJheTxhbnk+ID0gW107XG4gICAgcHVibGljIHNhbGVzSWQ6IE51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgX2NoYW5nZURldGVjdGlvblJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsIHByaXZhdGUgcm91dGVyOiBSb3V0ZXJFeHRlbnNpb25zKSB7XG4gICAgICAgIHRoaXMuY3JlYXRlSW52ZW50b3J5KCk7XG4gICAgICAgIHRoaXMuY3JlYXRlU2FsZXMoKTtcbiAgICB9XG5cbiAgICBAVmlld0NoaWxkKFJhZFNpZGVEcmF3ZXJDb21wb25lbnQpIHB1YmxpYyBkcmF3ZXJDb21wb25lbnQ6IFJhZFNpZGVEcmF3ZXJDb21wb25lbnQ7XG4gICAgcHJpdmF0ZSBkcmF3ZXI6IFJhZFNpZGVEcmF3ZXI7XG5cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIHRoaXMuZHJhd2VyID0gdGhpcy5kcmF3ZXJDb21wb25lbnQuc2lkZURyYXdlcjtcbiAgICAgICAgdGhpcy5fY2hhbmdlRGV0ZWN0aW9uUmVmLmRldGVjdENoYW5nZXMoKTtcblxuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLnZlbmRvciA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwidmVuZG9yXCIpO1xuICAgICAgICB0aGlzLm5hbWUgPSB0aGlzLnZlbmRvci5uYW1lO1xuICAgICAgICB0aGlzLnNhbGVzSWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInNhbGVzSWRcIik7XG4gICAgICAgIHRoaXMuZmV0Y2goKTsgLy8gQ29uc2lndWUgdG9kb3MgbG9zIGl0ZW1zIGRlbCBpbnZlbnRhcmlvIChpbnZlbnRvcnkgdGFibGUpLlxuICAgICAgICB0aGlzLmdldFNhbGVzKCk7IC8vIENvbnNpZ3VlIHRvZG9zIGxvcyBpdGVtIGRlIHNhbGVzLlxuICAgICAgICBjb25zb2xlLmxvZyhcIlNhbGVzSWQgaXM6IFwiLCB0aGlzLnNhbGVzSWQpO1xuICAgIH1cblxuICAgIC8vRWplY3V0YWRhIGN1YW5kbyBlbCB1c3VhcmlvIHNlbGVjY2lvbmEgdW5hIGNlbGRhLlxuICAgIHB1YmxpYyBvbkl0ZW1UYXAoYXJncykge1xuXG4gICAgICAgIGxldCBpbmRleCA9IGFyZ3MuaW5kZXhcbiAgICAgICAgbGV0IHNlbGVjdGVkSXRlbSA9IHtcbiAgICAgICAgICAgIFwicHJvZHVjdElkXCI6IHRoaXMuaW52ZW50b3J5W2luZGV4XS5wcm9kdWN0SWQsXG4gICAgICAgICAgICBcInByb2R1Y3RDb2RlXCI6IHRoaXMuaW52ZW50b3J5W2luZGV4XS5wcm9kdWN0Q29kZSxcbiAgICAgICAgICAgIFwicHJvZHVjdE5hbWVcIjogdGhpcy5pbnZlbnRvcnlbaW5kZXhdLnByb2R1Y3ROYW1lLFxuICAgICAgICAgICAgXCJwcm9kdWN0Q2F0ZWdvcnlcIjogdGhpcy5pbnZlbnRvcnlbaW5kZXhdLnByb2R1Y3RDYXRlZ29yeSxcbiAgICAgICAgICAgIFwicHJvZHVjdFByaWNlXCI6IHRoaXMuaW52ZW50b3J5W2luZGV4XS5wcm9kdWN0UHJpY2UsXG4gICAgICAgICAgICBcImJhbGFuY2VcIjogdGhpcy5pbnZlbnRvcnlbaW5kZXhdLmJhbGFuY2UsXG4gICAgICAgICAgICBcInF1YW50aXR5XCI6IDFcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmludmVudG9yeVtpbmRleF0uaXNWaXNpYmxlKSB7XG4gICAgICAgICAgICBkaWFsb2dzLmNvbmZpcm0oe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBcIkVsaW1pbmFyIGRlbCBCb2xzb1wiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiwr9EZXNlYSBlbGltaW5hciBlbCBwcm9kdWN0byBkZWwgYm9sc28gZGUgY29tcHJhP1wiLFxuICAgICAgICAgICAgICAgIG9rQnV0dG9uVGV4dDogXCJTaVwiLFxuICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiTm9cIlxuICAgICAgICAgICAgfSkudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWVPZigpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW52ZW50b3J5W2luZGV4XS5pc1Zpc2libGUgPSAwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUludmVudG9yeShzZWxlY3RlZEl0ZW0ucHJvZHVjdElkLCB0aGlzLmludmVudG9yeVtpbmRleF0uaXNWaXNpYmxlLCBzZWxlY3RlZEl0ZW0ucXVhbnRpdHksIHNlbGVjdGVkSXRlbS5wcm9kdWN0UHJpY2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGlhbG9ncy5wcm9tcHQoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBcIkNhbnRpZGFkIGEgVmVuZGVyXCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJFbnRyZSBsYSBjYW50aWRhZCBkZSBwcm9kdWN0b3MgcXVlIGRlc2VhIHZlbmRlci5cIixcbiAgICAgICAgICAgICAgICBva0J1dHRvblRleHQ6IFwiQ29uZmlybWFyXCIsXG4gICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogXCJDYW5jZWxhclwiLFxuICAgICAgICAgICAgICAgIGRlZmF1bHRUZXh0OiBzZWxlY3RlZEl0ZW0ucXVhbnRpdHkudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpbnB1dFR5cGU6IGRpYWxvZ3MuaW5wdXRUeXBlLnRleHQsXG4gICAgICAgICAgICB9KS50aGVuKHJlc3VsdCA9PiB7XG5cbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIkRpYWxvZyByZXN1bHQ6IFwiICsgcmVzdWx0LnJlc3VsdCArIFwiLCB0ZXh0OiBcIiArIHJlc3VsdC50ZXh0KTtcblxuICAgICAgICAgICAgICAgIGlmIChpc05hTigrcmVzdWx0LnRleHQpIHx8IHJlc3VsdC50ZXh0ID09PSBcIlwiIHx8IHJlc3VsdC50ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9ncy5jb25maXJtKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIkVudHJlIHVuIHZhbG9yIG7Dum1lcmljb1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJGYXZvciBkZSBlbnRyYXIgdW4gdmFsb3IgbsO6bWVyaWNvIHBhcmEgcXVlIGVsIHByb2R1Y3RvIHNlYSBhw7FhZGlkbyBhbCBib2xzbyBkZSB2ZW50YXMuXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBva0J1dHRvblRleHQ6IFwiT0tcIixcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRJdGVtLnF1YW50aXR5ID0gK3Jlc3VsdC50ZXh0O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYWxlcy5wdXNoKHNlbGVjdGVkSXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmludmVudG9yeVtpbmRleF0uaXNWaXNpYmxlID0gMTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy9TZSBhY3R1YWxpemEgZWwgaW52ZW50YXJpbyBpbmRpY2FuZG8gcXVlIGVsIHByb2R1Y3RvIGVzIGRlc2VhZG9cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlSW52ZW50b3J5KHNlbGVjdGVkSXRlbS5wcm9kdWN0SWQsIHRoaXMuaW52ZW50b3J5W2luZGV4XS5pc1Zpc2libGUsIHNlbGVjdGVkSXRlbS5xdWFudGl0eSwgc2VsZWN0ZWRJdGVtLnByb2R1Y3RQcmljZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnNhbGVzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGNyZWF0ZUludmVudG9yeSgpIHtcbiAgICAgICAgKG5ldyBTcWxpdGUoXCJib290aC5kYlwiKSkudGhlbihkYiA9PiB7XG4gICAgICAgICAgICBkYi5leGVjU1FMKFwiQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgaW52ZW50b3J5IChpZCBJTlRFR0VSIFBSSU1BUlkgS0VZIEFVVE9JTkNSRU1FTlQsIHByb2R1Y3RDb2RlIFRFWFQsIHByb2R1Y3ROYW1lIFRFWFQsIHByb2R1Y3RDYXRlZ29yeSBURVhULCBwcm9kdWN0UHJpY2UgVEVYVCwgaW5pdGlhbEJhbGFuY2UgSU5URUdFUiwgYmFsYW5jZSBJTlRFR0VSLCBpc1Zpc2libGUgSU5URUdFUilcIikudGhlbihpZCA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhYmFzZSA9IGRiO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU3VjY2Vzc1wiKTtcbiAgICAgICAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNSRUFURSBUQUJMRSBFUlJPUlwiLCBlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJPUEVOIERCIEVSUk9SXCIsIGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGZldGNoKCkge1xuICAgICAgICB0aGlzLmRhdGFiYXNlLmFsbChcIlNFTEVDVCAqIEZST00gaW52ZW50b3J5XCIpLnRoZW4ocm93cyA9PiB7XG4gICAgICAgICAgICB0aGlzLmludmVudG9yeSA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgcm93IGluIHJvd3MpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmludmVudG9yeS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgXCJwcm9kdWN0SWRcIjogcm93c1tyb3ddWzBdLFxuICAgICAgICAgICAgICAgICAgICBcInByb2R1Y3RDb2RlXCI6IHJvd3Nbcm93XVsxXSxcbiAgICAgICAgICAgICAgICAgICAgXCJwcm9kdWN0TmFtZVwiOiByb3dzW3Jvd11bMl0sXG4gICAgICAgICAgICAgICAgICAgIFwicHJvZHVjdENhdGVnb3J5XCI6IHJvd3Nbcm93XVszXSxcbiAgICAgICAgICAgICAgICAgICAgXCJwcm9kdWN0UHJpY2VcIjogcm93c1tyb3ddWzRdLFxuICAgICAgICAgICAgICAgICAgICBcImluaXRpYWxCYWxhbmNlXCI6IHJvd3Nbcm93XVs1XSxcbiAgICAgICAgICAgICAgICAgICAgXCJiYWxhbmNlXCI6IHJvd3Nbcm93XVs2XSxcbiAgICAgICAgICAgICAgICAgICAgXCJpc1Zpc2libGVcIjogcm93c1tyb3ddWzddLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNFTEVDVCBFUlJPUlwiLCBlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyB1cGRhdGVJbnZlbnRvcnkoaWQsIGlzVmlzaWJsZSwgcXVhbnRpdHksIHByaWNlKSB7XG4gICAgICAgIHRoaXMuZGF0YWJhc2UuZXhlY1NRTChcIlVQREFURSBpbnZlbnRvcnkgU0VUIGlzVmlzaWJsZSA9IFwiICsgaXNWaXNpYmxlICsgXCIgV0hFUkUgaWQgPSBcIiArIGlkKS50aGVuKCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkludmVudGFyaW8gQWN0dWFsaXphZG9cIik7XG4gICAgICAgICAgICBpZiAoaXNWaXNpYmxlID09PSAxKSB7XG4gICAgICAgICAgICAgICAgbGV0IHByaWNlU3VtID0gdGhpcy5nZXRQcmljZVN1bShxdWFudGl0eSwgcHJpY2UpO1xuICAgICAgICAgICAgICAgIHRoaXMuaW5zZXJ0VG9TYWxlcyhpZCwgcXVhbnRpdHksIHByaWNlU3VtKTtcbiAgICAgICAgICAgICAgICB0aGlzLmdldFNhbGVzKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlU2FsZShpZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRTYWxlcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIklOU0VSVCBFUlJPUlwiLCBlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qIFNlIGNyZWEgbGEgdGFibGEgc2FsZXMgZW4gZG9uZGUgc2UgZXN0YXJhIGd1YXJkYW5kbyBsYSBpbmZvcm1hY2nDs25cbiAgICBkZSBsYXMgdmVudGFzIHF1ZSBzZSBlc3RhbiBoYWNpZW5kbyBhbCBtb21lbnRvLiBFc3RhcyBzZSBjb252ZXJ0aXJhbiBlbiBvcmRlblxuICAgIGVuIGVsIGJvbHNvIGRlIHZlbnRhcy4gRXN0YSBmdW5jacOzbiBlcyBsbGFtYWRhIGVuIGVsIGNvbnN0cnVjdG9yLiAqL1xuICAgIHB1YmxpYyBjcmVhdGVTYWxlcygpIHtcbiAgICAgICAgKG5ldyBTcWxpdGUoXCJib290aC5kYlwiKSkudGhlbihkYiA9PiB7XG4gICAgICAgICAgICBsZXQgdmVuZG9ySWQgPSBcIkZPUkVJR04gS0VZICh2ZW5kb3JJZCkgUkVGRVJFTkNFUyB2ZW5kb3IodmVuZG9ySWQpIE9OIFVQREFURSBDQVNDQURFIE9OIERFTEVURSBDQVNDQURFLCBcIjtcbiAgICAgICAgICAgIGxldCBwcm9kdWN0SWQgPSBcIiBGT1JFSUdOIEtFWSAocHJvZHVjdElkKSBSRUZFUkVOQ0VTIGludmVudG9yeShpZCkgT04gVVBEQVRFIENBU0NBREUgT04gREVMRVRFIENBU0NBREUsIFwiO1xuICAgICAgICAgICAgZGIuZXhlY1NRTChcIkNSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIHNhbGVzIChzYWxlc0lkIElOVEVHRVIsIHZlbmRvcklkIElOVEVHRVIgTk9UIE5VTEwsIHByb2R1Y3RJZCBJTlRFR0VSIE5PVCBOVUxMLCBxdWFudGl0eVRvU2FsZSBJTlRFR0VSLCBwcmljZVN1bSAgVEVYVCwgXCIgKyB2ZW5kb3JJZCArIHByb2R1Y3RJZCArIFwiIFBSSU1BUlkgS0VZIChzYWxlc0lkLCB2ZW5kb3JJZCwgcHJvZHVjdElkKSlcIikudGhlbihpZCA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhYmFzZSA9IGRiO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU3VjY2Vzc1wiKTtcbiAgICAgICAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNSRUFURSBUQUJMRSBFUlJPUlwiLCBlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJPUEVOIERCIEVSUk9SXCIsIGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFNhbGVzKCkge1xuICAgICAgICB0aGlzLmRhdGFiYXNlLmFsbChcIlNFTEVDVCAqIEZST00gc2FsZXMgV0hFUkUgc2FsZXMuc2FsZXNJZCA9IFwiICsgdGhpcy5zYWxlc0lkKS50aGVuKHJvd3MgPT4ge1xuICAgICAgICAgICAgdGhpcy5zYWxlcyA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgcm93IGluIHJvd3MpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNhbGVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBcInNhbGVzSWRcIjogcm93c1tyb3ddWzBdLFxuICAgICAgICAgICAgICAgICAgICBcInZlbmRvcklkXCI6IHJvd3Nbcm93XVsxXSxcbiAgICAgICAgICAgICAgICAgICAgXCJwcm9kdWN0SWRcIjogcm93c1tyb3ddWzJdLFxuICAgICAgICAgICAgICAgICAgICBcInF1YW50aXR5VG9TYWxlXCI6IHJvd3Nbcm93XVszXSxcbiAgICAgICAgICAgICAgICAgICAgXCJwcmljZVN1bVwiOiByb3dzW3Jvd11bNF1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMuc2FsZXMpO1xuICAgICAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNFTEVDVCBFUlJPUlwiLCBlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBpbnNlcnRUb1NhbGVzKHByb2R1Y3RJZCwgcXVhbnRpdHksIHByaWNlKSB7XG4gICAgICAgIHRoaXMuZGF0YWJhc2UuZXhlY1NRTChcIklOU0VSVCBvciBJR05PUkUgSU5UTyBzYWxlcyAoc2FsZXNJZCwgdmVuZG9ySWQsIHByb2R1Y3RJZCwgcXVhbnRpdHlUb1NhbGUsIHByaWNlU3VtKSBWQUxVRVMgKD8sID8sID8sID8sID8pXCIsXG4gICAgICAgICAgICBbdGhpcy5zYWxlc0lkLCB0aGlzLnZlbmRvci52ZW5kb3JJZCwgcHJvZHVjdElkLCBxdWFudGl0eSwgcHJpY2VdKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgbWVzc2FnZSA9ICdQcm9kdWN0byBhw7FhZGlkbyBhbCBib2xzbyBkZSB2ZW50YXMnO1xuICAgICAgICAgICAgICAgIGxldCB0b2FzdE9wdGlvbnM6IFRvYXN0LlRvYXN0T3B0aW9ucyA9IHsgdGV4dDogbWVzc2FnZSwgZHVyYXRpb246IFRvYXN0LkRVUkFUSU9OLlNIT1JUIH07XG4gICAgICAgICAgICAgICAgVG9hc3Quc2hvdyh0b2FzdE9wdGlvbnMpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRTYWxlcygpO1xuICAgICAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSU5TRVJUIEVSUk9SXCIsIGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBkZWxldGVTYWxlKHByb2R1Y3RJZCkge1xuICAgICAgICB0aGlzLmRhdGFiYXNlLmV4ZWNTUUwoXCJERUxFVEUgRlJPTSBzYWxlcyBXSEVSRSBwcm9kdWN0SWQ9XCIgKyBwcm9kdWN0SWQsICkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBsZXQgbWVzc2FnZSA9ICdQcm9kdWN0byBlbGltaW5hZG8gZGVsIGJvbHNvIGRlIHZlbnRhcyc7XG4gICAgICAgICAgICBsZXQgdG9hc3RPcHRpb25zOiBUb2FzdC5Ub2FzdE9wdGlvbnMgPSB7IHRleHQ6IG1lc3NhZ2UsIGR1cmF0aW9uOiBUb2FzdC5EVVJBVElPTi5TSE9SVCB9O1xuICAgICAgICAgICAgVG9hc3Quc2hvdyh0b2FzdE9wdGlvbnMpO1xuICAgICAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIklOU0VSVCBFUlJPUlwiLCBlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRQcmljZVN1bShxdWFudGl0eSwgcHJpY2UpOiBOdW1iZXIge1xuICAgICAgICBsZXQgdG90YWwgPSArcXVhbnRpdHkgKiArcHJpY2U7XG4gICAgICAgIHJldHVybiB0b3RhbDtcbiAgICB9XG5cbiAgICBwdWJsaWMgb3BlbkRyYXdlcigpIHtcbiAgICAgICAgdGhpcy5kcmF3ZXIuc2hvd0RyYXdlcigpO1xuICAgIH1cblxuICAgIHB1YmxpYyBvbkNsb3NlRHJhd2VyVGFwKCkge1xuICAgICAgICB0aGlzLmRyYXdlci5jbG9zZURyYXdlcigpO1xuICAgIH1cblxuICAgIHB1YmxpYyBvcmRlckJhZygpIHtcbiAgICAgICAgaWYgKHRoaXMuc2FsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBsZXQgdGl0bGUgPSBcIk5vIEhheSBQcm9kdWN0b3NcIjtcbiAgICAgICAgICAgIGxldCBtZXNzYWdlID0gXCJObyBoYXkgcHJvZHVjdG9zIGVuIGVsIGJvbHNvIGRlIHZlbnRhLCBmYXZvciBkZSBzZWxlY2Npb25hciB1biBwcm9kdWN0byBwYXJhIHByb2R1Y2lyIHVuYSBvcmRlbi5cIjtcbiAgICAgICAgICAgIGxldCBidXR0b25UaXRsZSA9IFwiT0tcIjtcbiAgICAgICAgICAgIFROU0ZhbmN5QWxlcnQuc2hvd1dhcm5pbmcodGl0bGUsIG1lc3NhZ2UsIGJ1dHRvblRpdGxlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFtcImJhZ1wiXSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgdG9JbmljaW8oKSB7XG4gICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFsnbWFpbiddLCB7IGNsZWFySGlzdG9yeTogdHJ1ZSB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdG9JbnZlbnRhcmlvKCkge1xuICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbJ2ludmVudGFyaW8nXSwgeyBjbGVhckhpc3Rvcnk6IHRydWUgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIHRvT3JkZW5lcygpIHtcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoWydvcmRlbmVzJ10sIHsgY2xlYXJIaXN0b3J5OiB0cnVlIH0pXG4gICAgfVxuXG4gICAgcHVibGljIHRvQWp1c3RlcygpIHtcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoWydzZXR0aW5ncyddLCB7IGNsZWFySGlzdG9yeTogdHJ1ZSB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdG9BYm91dCgpIHtcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoW1wiYWJvdXRcIl0sIHsgY2xlYXJIaXN0b3J5OiB0cnVlfSk7XG4gICAgfVxufSJdfQ==